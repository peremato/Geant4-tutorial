
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sensitive Detectors &#8212; Geant4.jl Tutorials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '08-sensitive-detectors';</script>
    <script data-domain="hepsoftwarefoundation.org" defer="defer" src="https://views.scientific-python.org/js/script.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Scoring Meshes" href="09-scoring-meshes.html" />
    <link rel="prev" title="Building Applications" href="07-applications.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/juliaheplogo.png" class="logo__image only-light" alt="Geant4.jl Tutorials - Home"/>
    <script>document.write(`<img src="_static/juliaheplogo.png" class="logo__image only-dark" alt="Geant4.jl Tutorials - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Welcome to Geant4.jl Tutorial
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Building Simulation Applications</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-introduction.html">Introduction to Geant4.jl</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-wrapped-classes.html">Interacting with the wrapped classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-geometry.html">Defining Geant4.jl Geometries</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-physics-list.html">Defining Physics Lists</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-primary-particles.html">Defining Primary Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-field.html">Defining Magnetic Field</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-applications.html">Building Applications</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Sensitive Detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="09-scoring-meshes.html">Scoring Meshes</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-histograms.html">Histograms</a></li>
<li class="toctree-l1"><a class="reference internal" href="11-event-display.html">Event Display</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Complete Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="examples/HBC30/HBC30.html">CERN Liquid Hydrogen Bubble Chamber</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/WaterPhantom/WaterPhantom.html">Water Phantom Simulation with Scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/Scintillation/Scintillation.html">Scintillating Detector Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/TestEm3/TestEm3.html">TestEM3 Example</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/peremato/Geant4.jl-tutorial" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/peremato/Geant4.jl-tutorial/issues/new?title=Issue%20on%20page%20%2F08-sensitive-detectors.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/08-sensitive-detectors.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Sensitive Detectors</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitive-detector-data">Sensitive Detector Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitive-detector-functions">Sensitive Detector Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sd-instance">SD Instance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-application">Define Application</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="sensitive-detectors">
<h1>Sensitive Detectors<a class="headerlink" href="#sensitive-detectors" title="Link to this heading">#</a></h1>
<p>The user can define sensitive detectors by defining a custom data structure and 3 callback functions, which will initialize, fill and dispose the defined data structure. Later, the instantiated sensitive detector would be associated to one or more logical volumes of the detector setup.</p>
<p>Instantiating a <code class="docutils literal notranslate"><span class="pre">G4JLSensitiveDetector</span></code> will require the following arguments:</p>
<ul class="simple">
<li><p><strong>name</strong>. A string to identify the sensitive detector. No default.</p></li>
<li><p><strong>sd data</strong>. A instance of a user defined <code class="docutils literal notranslate"><span class="pre">G4JLSDData</span></code> mutable data structure that will passed to each callback invocation.</p></li>
<li><p><strong>initialize method</strong>. User method that is called at the beginning of each event. The signature is <code class="docutils literal notranslate"><span class="pre">(::B2aSDData,</span> <span class="pre">::G4HCofThisEvent)::Nothing</span></code>.</p></li>
<li><p><strong>endOfEvent method</strong>. User method that is called at the end of each event. The signature is <code class="docutils literal notranslate"><span class="pre">(::B2aSDData,</span> <span class="pre">::G4HCofThisEvent)::Nothing</span></code>.</p></li>
<li><p><strong>processHits method</strong>. User method that is called at simulation step that ends at the associated logical volume. The signature is <code class="docutils literal notranslate"><span class="pre">(::B2aSDData,</span> <span class="pre">::G4Step,</span> <span class="pre">::G4TouchableHistory)::Bool</span></code>. Consult the <a class="reference external" href="https://geant4.kek.jp/Reference/v11.1.1/classG4Step.html">G4Step</a> reference manual to see what you can get from the G4Step. It returns true if a true hit is generated.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Geant4</span>
<span class="k">using</span><span class="w"> </span><span class="n">Geant4</span><span class="o">.</span><span class="n">SystemOfUnits</span>
</pre></div>
</div>
</div>
</div>
<section id="sensitive-detector-data">
<h2>Sensitive Detector Data<a class="headerlink" href="#sensitive-detector-data" title="Link to this heading">#</a></h2>
<p>Let’s define something very simple, for example collecting generated <code class="docutils literal notranslate"><span class="pre">Hits</span></code> (i.e deposit energies) on a sensitive detector.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#---Hit structure------------------------------------------------------------------</span>
<span class="nd">@enum</span><span class="w"> </span><span class="n">HitType</span><span class="w"> </span><span class="n">Si</span><span class="w"> </span><span class="n">ScintCryst</span>
<span class="k">struct</span> <span class="kt">Hit</span>
<span class="w">    </span><span class="n">arrivalTime</span><span class="o">::</span><span class="kt">Float64</span>
<span class="w">    </span><span class="n">depositedEnergy</span><span class="o">::</span><span class="kt">Float64</span>
<span class="w">    </span><span class="n">hittype</span><span class="o">::</span><span class="kt">HitType</span>
<span class="w">    </span><span class="n">position</span><span class="o">::</span><span class="kt">G4ThreeVector</span>
<span class="w">    </span><span class="k">function</span><span class="w"> </span><span class="n">Hit</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">edep</span><span class="p">,</span><span class="w"> </span><span class="n">typ</span><span class="p">)</span><span class="w">  </span><span class="c"># constructor</span>
<span class="w">        </span><span class="n">hit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">edep</span><span class="p">,</span><span class="w"> </span><span class="n">typ</span><span class="p">,</span><span class="w"> </span><span class="n">G4ThreeVector</span><span class="p">())</span>
<span class="w">        </span><span class="n">assign</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w">       </span><span class="c"># this is needed to fill a G4ThreeVector (in C++ = operator)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">hit</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>

<span class="c">#--SD data structure---------------------------------------------------------------</span>
<span class="k">struct</span> <span class="kt">CrystalSDData</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">G4JLSDData</span>
<span class="w">    </span><span class="n">hitcollection</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Hit</span><span class="p">}</span><span class="w">      </span><span class="c"># define a hit collection</span>
<span class="w">    </span><span class="n">CrystalSDData</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">Hit</span><span class="p">[])</span><span class="w">    </span><span class="c"># default constructor</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sensitive-detector-functions">
<h2>Sensitive Detector Functions<a class="headerlink" href="#sensitive-detector-functions" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#---Initialize method------------------------------------------------------------------------------</span>
<span class="k">function</span><span class="w"> </span><span class="n">crystal_initialize</span><span class="p">(</span><span class="o">::</span><span class="kt">G4HCofThisEvent</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">::</span><span class="kt">CrystalSDData</span><span class="p">)</span><span class="o">::</span><span class="kt">Nothing</span>
<span class="w">    </span><span class="n">empty!</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">hitcollection</span><span class="p">)</span><span class="w">                                </span><span class="c"># empty the hit collection at every event</span>
<span class="w">    </span><span class="k">return</span>
<span class="k">end</span>
<span class="c">#---Process Hit method-----------------------------------------------------------------------------</span>
<span class="k">function</span><span class="w"> </span><span class="n">crystal_processHits</span><span class="p">(</span><span class="n">step</span><span class="o">::</span><span class="kt">G4Step</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="kt">G4TouchableHistory</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">::</span><span class="kt">CrystalSDData</span><span class="p">)</span><span class="o">::</span><span class="kt">Bool</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">GetTrack</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">GetParticleDefinition</span>
<span class="w">    </span><span class="n">edep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">GetTotalEnergyDeposit</span>
<span class="w">    </span><span class="n">edep</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mf">0.</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span>
<span class="w">    </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">GetPostStepPoint</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">GetPosition</span>
<span class="w">    </span><span class="n">push!</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">hitcollection</span><span class="p">,</span><span class="w"> </span><span class="n">Hit</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">edep</span><span class="p">,</span><span class="w"> </span><span class="n">ScintCryst</span><span class="p">))</span><span class="w">  </span><span class="c"># fill the collection with a new Hit</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>crystal_processHits (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
</section>
<section id="sd-instance">
<h2>SD Instance<a class="headerlink" href="#sd-instance" title="Link to this heading">#</a></h2>
<p>And finally construct the SD instance</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#---Create SD instance-----------------------------------------------------------------------------</span>
<span class="n">crystal_sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4JLSensitiveDetector</span><span class="p">(</span><span class="s">&quot;Crystal_SD&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CrystalSDData</span><span class="p">();</span><span class="w">           </span><span class="c"># name an associated data are mandatory</span>
<span class="w">             </span><span class="n">processhits_method</span><span class="o">=</span><span class="n">crystal_processHits</span><span class="p">,</span><span class="w"> </span><span class="c"># process hits method (also mandatory)</span>
<span class="w">             </span><span class="n">initialize_method</span><span class="o">=</span><span class="n">crystal_initialize</span><span class="p">)</span><span class="w">   </span><span class="c"># intialize method</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Geant4.G4JLProtoSD{CrystalSDData}(&quot;Crystal_SD&quot;, CrystalSDData(Hit[]), crystal_processHits, crystal_initialize, nothing)
</pre></div>
</div>
</div>
</div>
<p>To test this created SD we will create a very simple detector geometry</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">SimpleDetector</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">G4JLDetector</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">end</span>

<span class="c">#---Materials----------------------------------------------------------------------------------</span>
<span class="n">nist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4NistManager!Instance</span><span class="p">()</span>
<span class="n">m_air</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindOrBuildMaterial</span><span class="p">(</span><span class="n">nist</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;G4_AIR&quot;</span><span class="p">)</span>
<span class="n">m_bgo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindOrBuildMaterial</span><span class="p">(</span><span class="n">nist</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;G4_BGO&quot;</span><span class="p">)</span>

<span class="c">#---Volumes------------------------------------------------------------------------------------</span>
<span class="n">worldS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4Box</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">m</span><span class="p">)</span>
<span class="n">worldLV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4LogicalVolume</span><span class="p">(</span><span class="n">worldS</span><span class="p">,</span><span class="w"> </span><span class="n">m_air</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">)</span>
<span class="n">worldPV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4PVPlacement</span><span class="p">(</span><span class="nb">nothing</span><span class="p">,</span><span class="w"> </span><span class="n">G4ThreeVector</span><span class="p">(),</span><span class="w"> </span><span class="n">worldLV</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">nothing</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>

<span class="n">crystalS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4Box</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="n">cm</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="n">cm</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="n">cm</span><span class="p">)</span>
<span class="n">crystalLV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4LogicalVolume</span><span class="p">(</span><span class="n">crystalS</span><span class="p">,</span><span class="w"> </span><span class="n">m_bgo</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Crystal&quot;</span><span class="p">)</span>
<span class="n">crystalPV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4PVPlacement</span><span class="p">(</span><span class="nb">nothing</span><span class="p">,</span><span class="w"> </span><span class="n">G4ThreeVector</span><span class="p">(),</span><span class="w"> </span><span class="n">crystalLV</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Crystal&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">worldLV</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>

<span class="c">#---define getConstructor</span>
<span class="n">Geant4</span><span class="o">.</span><span class="n">getConstructor</span><span class="p">(</span><span class="o">::</span><span class="kt">SimpleDetector</span><span class="p">)</span><span class="o">::</span><span class="kt">Function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">::</span><span class="kt">SimpleDetector</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">worldPV</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-application">
<h2>Define Application<a class="headerlink" href="#define-application" title="Link to this heading">#</a></h2>
<p>We will use the end-of-event user action to see how many hits we have produced. We could also at this moment to store the hits of some statistical data for each event. Be aware that the function is called from different threads. It is the responsibility of the developer to ensure that the function es thread safe. The function <code class="docutils literal notranslate"><span class="pre">getSDdata</span></code> ensures that you get a copy of the SD data that corresponds to the running thread.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#---End Event Action-------------------------------------------------------------------------------</span>
<span class="k">function</span><span class="w"> </span><span class="n">endeventaction</span><span class="p">(</span><span class="n">evt</span><span class="o">::</span><span class="kt">G4Event</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="o">::</span><span class="kt">G4JLApplication</span><span class="p">)</span>
<span class="w">    </span><span class="n">hits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSDdata</span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Crystal_SD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hitcollection</span>
<span class="w">    </span><span class="n">eventID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evt</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">GetEventID</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">eventID</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">eventID</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="n">G4JL_println</span><span class="p">(</span><span class="s">&quot;Event: </span><span class="si">$eventID</span><span class="s"> with </span><span class="si">$</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">hits</span><span class="p">))</span><span class="s"> hits stored in this event&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="k">return</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>endeventaction (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<p>We use a simple particle gun</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">particlegun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4JLGunGenerator</span><span class="p">(</span><span class="n">particle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;e-&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">energy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="n">GeV</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4ThreeVector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span>
<span class="w">                               </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4ThreeVector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="n">m</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>G4JLGunGenerator(&quot;ParticleGun&quot;, Geant4.G4JLParticleGunData(nothing, &quot;e-&quot;, G4ThreeVector(0.0,0.0,1.0), G4ThreeVector(0.0,0.0,-1000.0), 3000.0), Geant4.var&quot;#init#19&quot;(), Geant4.var&quot;#gen#20&quot;(), G4JLGeneratorAction[])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#---Create the Application-------------------------------------------------------------------------</span>
<span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4JLApplication</span><span class="p">(</span><span class="w"> </span><span class="n">detector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SimpleDetector</span><span class="p">(),</span><span class="w">                  </span><span class="c"># detector with parameters</span>
<span class="w">                       </span><span class="n">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">particlegun</span><span class="p">,</span><span class="w">                      </span><span class="c"># primary particle generator</span>
<span class="w">                       </span><span class="n">nthreads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">                                 </span><span class="c"># number of threads (MT)</span>
<span class="w">                       </span><span class="n">physics_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTFP_BERT</span><span class="p">,</span><span class="w">                     </span><span class="c"># what physics list to instantiate</span>
<span class="w">                       </span><span class="n">endeventaction_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">endeventaction</span><span class="p">,</span><span class="w">       </span><span class="c"># end event action</span>
<span class="w">                       </span><span class="n">sdetectors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;Crystal&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">crystal_sd</span><span class="p">]</span><span class="w">        </span><span class="c"># mapping of LVs to SDs (+ means multiple LVs with same name)</span>
<span class="w">                      </span><span class="p">)</span>
<span class="n">configure</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>**************************************************************
 Geant4 version Name: geant4-11-02 [MT]   (8-December-2023)
  &lt;&lt; in Multi-threaded mode &gt;&gt; 
                       Copyright : Geant4 Collaboration
                      References : NIM A 506 (2003), 250-303
                                 : IEEE-TNS 53 (2006), 270-278
                                 : NIM A 835 (2016), 186-225
                             WWW : http://geant4.org/
**************************************************************
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">beamOn</span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>G4WT3 &gt; Event: 3 with 7236 hits stored in this event
G4WT1 &gt; Event: 0 with 7383 hits stored in this event
G4WT0 &gt; Event: 2 with 7106 hits stored in this event
G4WT2 &gt; Event: 1 with 7393 hits stored in this event
G4WT1 &gt; Event: 4 with 7155 hits stored in this event
G4WT0 &gt; Event: 6 with 7196 hits stored in this event
G4WT3 &gt; Event: 5 with 7543 hits stored in this event
G4WT2 &gt; Event: 7 with 7250 hits stored in this event
G4WT1 &gt; Event: 8 with 7071 hits stored in this event
G4WT0 &gt; Event: 9 with 7313 hits stored in this event
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.10"
        },
        kernelOptions: {
            name: "julia-1.10",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.10'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="07-applications.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Building Applications</p>
      </div>
    </a>
    <a class="right-next"
       href="09-scoring-meshes.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Scoring Meshes</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitive-detector-data">Sensitive Detector Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitive-detector-functions">Sensitive Detector Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sd-instance">SD Instance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-application">Define Application</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Pere Mato
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright CERN, The Contributors 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>