
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Scoring Meshes &#8212; Geant4.jl Tutorials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '09-scoring-meshes';</script>
    <script data-domain="hepsoftwarefoundation.org" defer="defer" src="https://views.scientific-python.org/js/script.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Histograms" href="10-histograms.html" />
    <link rel="prev" title="Sensitive Detectors" href="08-sensitive-detectors.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/juliaheplogo.png" class="logo__image only-light" alt="Geant4.jl Tutorials - Home"/>
    <img src="_static/juliaheplogo.png" class="logo__image only-dark pst-js-only" alt="Geant4.jl Tutorials - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Welcome to Geant4.jl Tutorial
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Building Simulation Applications</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-introduction.html">Introduction to Geant4.jl</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-wrapped-classes.html">Interacting with the wrapped classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-geometry.html">Defining Geant4.jl Geometries</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-physics-list.html">Defining Physics Lists</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-primary-particles.html">Defining Primary Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-field.html">Defining Magnetic Field</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-applications.html">Building Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="08-sensitive-detectors.html">Sensitive Detectors</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Scoring Meshes</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-histograms.html">Histograms</a></li>
<li class="toctree-l1"><a class="reference internal" href="11-event-display.html">Event Display</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Complete Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="examples/HBC30/HBC30.html">CERN Liquid Hydrogen Bubble Chamber</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/WaterPhantom/WaterPhantom.html">Water Phantom Simulation with Scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/Scintillation/Scintillation.html">Scintillating Detector Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/TestEm3/TestEm3.html">TestEM3 Example</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/peremato/Geant4.jl-tutorial" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/peremato/Geant4.jl-tutorial/issues/new?title=Issue%20on%20page%20%2F09-scoring-meshes.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/09-scoring-meshes.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Scoring Meshes</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="scoring-meshes">
<h1>Scoring Meshes<a class="headerlink" href="#scoring-meshes" title="Link to this heading">#</a></h1>
<p>The user can specify scoring meshes to obtain quantities on the defined grid. In Geant4 this is achieved using a set of UI commands. In this Julia interface this functionality has been encapsulated in a number of data structures. The function to create a scoring mesh is <a class="reference internal" href="#&#64;ref"><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">G4JLScoringMesh</span></code></span></a> and receive as arguments the the type and dimensions of the mesh, the position, the rotation, the number of bins in each dimension, and the quantities to accumulate with eventually some filter conditions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Geant4</span>
<span class="k">using</span><span class="w"> </span><span class="n">Geant4</span><span class="o">.</span><span class="n">SystemOfUnits</span>
<span class="k">using</span><span class="w"> </span><span class="n">CairoMakie</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s define a simple detector (from the previous notebook on sensitive detectors)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">SimpleDetector</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">G4JLDetector</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">end</span>

<span class="c">#---Materials----------------------------------------------------------------------------------</span>
<span class="n">nist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4NistManager!Instance</span><span class="p">()</span>
<span class="n">m_air</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindOrBuildMaterial</span><span class="p">(</span><span class="n">nist</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;G4_AIR&quot;</span><span class="p">)</span>
<span class="n">m_bgo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindOrBuildMaterial</span><span class="p">(</span><span class="n">nist</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;G4_BGO&quot;</span><span class="p">)</span>

<span class="c">#---Volumes------------------------------------------------------------------------------------</span>
<span class="n">worldS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4Box</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">m</span><span class="p">)</span>
<span class="n">worldLV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4LogicalVolume</span><span class="p">(</span><span class="n">worldS</span><span class="p">,</span><span class="w"> </span><span class="n">m_air</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">)</span>
<span class="n">worldPV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4PVPlacement</span><span class="p">(</span><span class="nb">nothing</span><span class="p">,</span><span class="w"> </span><span class="n">G4ThreeVector</span><span class="p">(),</span><span class="w"> </span><span class="n">worldLV</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">nothing</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>

<span class="n">crystalS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4Box</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="n">cm</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="n">cm</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="n">cm</span><span class="p">)</span>
<span class="n">crystalLV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4LogicalVolume</span><span class="p">(</span><span class="n">crystalS</span><span class="p">,</span><span class="w"> </span><span class="n">m_bgo</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Crystal&quot;</span><span class="p">)</span>
<span class="n">crystalPV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4PVPlacement</span><span class="p">(</span><span class="nb">nothing</span><span class="p">,</span><span class="w"> </span><span class="n">G4ThreeVector</span><span class="p">(),</span><span class="w"> </span><span class="n">crystalLV</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Crystal&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">worldLV</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>

<span class="c">#---define getConstructor</span>
<span class="n">Geant4</span><span class="o">.</span><span class="n">getConstructor</span><span class="p">(</span><span class="o">::</span><span class="kt">SimpleDetector</span><span class="p">)</span><span class="o">::</span><span class="kt">Function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">::</span><span class="kt">SimpleDetector</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">worldPV</span>
</pre></div>
</div>
</div>
</div>
<p>We create a scoring mesh of the same size as the crystal and with bins 20, 20 and 40 in z direction to collect energy deposit, number of steps produced by gammas, electrons and positrons.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">sc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4JLScoringMesh</span><span class="p">(</span><span class="s">&quot;boxMesh_1&quot;</span><span class="p">,</span>
<span class="w">                      </span><span class="n">BoxMesh</span><span class="p">(</span><span class="mi">5</span><span class="n">cm</span><span class="p">,</span><span class="mi">5</span><span class="n">cm</span><span class="p">,</span><span class="mi">20</span><span class="n">cm</span><span class="p">),</span>
<span class="w">                      </span><span class="n">bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">),</span>
<span class="w">                      </span><span class="n">quantities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">energyDeposit</span><span class="p">(</span><span class="s">&quot;eDep&quot;</span><span class="p">)</span>
<span class="w">                                     </span><span class="n">nOfStep</span><span class="p">(</span><span class="s">&quot;nOfStepGamma&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">ParticleFilter</span><span class="p">(</span><span class="s">&quot;gammafilter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gamma&quot;</span><span class="p">)])</span>
<span class="w">                                     </span><span class="n">nOfStep</span><span class="p">(</span><span class="s">&quot;nOfStepEMinus&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">ParticleFilter</span><span class="p">(</span><span class="s">&quot;eMinusFilter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e-&quot;</span><span class="p">)])</span>
<span class="w">                                     </span><span class="n">nOfStep</span><span class="p">(</span><span class="s">&quot;nOfStepEPlus&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">ParticleFilter</span><span class="p">(</span><span class="s">&quot;ePlusFilter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e+&quot;</span><span class="p">)])</span>
<span class="w">                                   </span><span class="p">]</span>
<span class="w">                      </span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s initialize now the application</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">particlegun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4JLGunGenerator</span><span class="p">(</span><span class="n">particle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;e-&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">energy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="n">GeV</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4ThreeVector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span>
<span class="w">                               </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4ThreeVector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="n">m</span><span class="p">))</span>

<span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G4JLApplication</span><span class="p">(;</span><span class="n">detector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SimpleDetector</span><span class="p">(),</span><span class="w">                  </span><span class="c"># detector with parameters</span>
<span class="w">                       </span><span class="n">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">particlegun</span><span class="p">,</span><span class="w">                      </span><span class="c"># primary particle generator</span>
<span class="w">                       </span><span class="n">nthreads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">                                 </span><span class="c"># number of threads (MT)</span>
<span class="w">                       </span><span class="n">physics_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTFP_BERT</span><span class="p">,</span><span class="w">                     </span><span class="c"># what physics list to instantiate</span>
<span class="w">                       </span><span class="n">scorers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">sc1</span><span class="p">]</span><span class="w">                               </span><span class="c"># list of scorers </span>
<span class="w">                      </span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>**************************************************************
 Geant4 version Name: geant4-11-02-patch-01 [MT]   (16-February-2024)
  &lt;&lt; in Multi-threaded mode &gt;&gt; 
                       Copyright : Geant4 Collaboration
                      References : NIM A 506 (2003), 250-303
                                 : IEEE-TNS 53 (2006), 270-278
                                 : NIM A 835 (2016), 186-225
                             WWW : http://geant4.org/
**************************************************************
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">configure</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- G4CoupledTransportation is used 
.... G4ScoringMessenger::MeshBinCommand - G4ScoringBox
G4ScoringManager has 1 scoring meshes.
G4ScoringBox : boxMesh_1 --- Shape: Box mesh
 Size (x, y, z): (5, 5, 20) [cm]
 # of segments: (20, 20, 40)
 displacement: (0, 0, 0) [cm]
 registered primitve scorers : 
   0  eDep
   1  nOfStepGamma     with  gammafilter
   2  nOfStepEMinus     with  eMinusFilter
   3  nOfStepEPlus     with  ePlusFilter
</pre></div>
</div>
</div>
</div>
<p>run for 1000 events</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">beamOn</span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>G4WT3 &gt; .... G4ScoringMessenger::MeshBinCommand - G4ScoringBox
G4WT0 &gt; .... G4ScoringMessenger::MeshBinCommand - G4ScoringBox
G4WT1 &gt; .... G4ScoringMessenger::MeshBinCommand - G4ScoringBox
G4WT2 &gt; .... G4ScoringMessenger::MeshBinCommand - G4ScoringBox
G4WT0 &gt; G4ScoringManager has 1 scoring meshes.
G4WT0 &gt; G4ScoringBox : boxMesh_1 --- Shape: Box mesh
G4WT0 &gt;  Size (x, y, z): (5, 5, 20) [cm]
G4WT0 &gt;  # of segments: (20, 20, 40)
G4WT0 &gt;  displacement: (0, 0, 0) [cm]
G4WT0 &gt;  registered primitve scorers : 
G4WT0 &gt;    0  eDep
G4WT1 &gt; G4ScoringManager has 1 scoring meshes.
G4WT1 &gt; G4ScoringBox : boxMesh_1 --- Shape: Box mesh
G4WT0 &gt;    1  nOfStepGamma     with  gammafilter
G4WT2 &gt; G4ScoringManager has 1 scoring meshes.
G4WT0 &gt;    2  nOfStepEMinus     with  eMinusFilter
G4WT2 &gt; G4ScoringBox : boxMesh_1 --- Shape: Box mesh
G4WT3 &gt; G4ScoringManager has 1 scoring meshes.
G4WT1 &gt;  Size (x, y, z): (5, 5, 20) [cm]
G4WT3 &gt; G4ScoringBox : boxMesh_1 --- Shape: Box mesh
G4WT0 &gt;    3  nOfStepEPlus     with  ePlusFilter
G4WT2 &gt;  Size (x, y, z): (5, 5, 20) [cm]
G4WT2 &gt;  # of segments: (20, 20, 40)
G4WT1 &gt;  # of segments: (20, 20, 40)
G4WT2 &gt;  displacement: (0, 0, 0) [cm]
G4WT3 &gt;  Size (x, y, z): (5, 5, 20) [cm]
G4WT1 &gt;  displacement: (0, 0, 0) [cm]
G4WT1 &gt;  registered primitve scorers : 
G4WT3 &gt;  # of segments: (20, 20, 40)
G4WT1 &gt;    0  eDep
G4WT3 &gt;  displacement: (0, 0, 0) [cm]
G4WT2 &gt;  registered primitve scorers : 
G4WT2 &gt;    0  eDep
G4WT2 &gt;    1  nOfStepGamma     with  gammafilter
G4WT2 &gt;    2  nOfStepEMinus     with  eMinusFilter
G4WT1 &gt;    1  nOfStepGamma     with  gammafilter
G4WT3 &gt;  registered primitve scorers : 
G4WT1 &gt;    2  nOfStepEMinus     with  eMinusFilter
G4WT2 &gt;    3  nOfStepEPlus     with  ePlusFilter
G4WT1 &gt;    3  nOfStepEPlus     with  ePlusFilter
G4WT3 &gt;    0  eDep
G4WT3 &gt;    1  nOfStepGamma     with  gammafilter
G4WT3 &gt;    2  nOfStepEMinus     with  eMinusFilter
G4WT3 &gt;    3  nOfStepEPlus     with  ePlusFilter
</pre></div>
</div>
</div>
</div>
<p>Now the scoring mesh variable <code class="docutils literal notranslate"><span class="pre">sc1</span></code> holds the collected information</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="n">sum2</span><span class="p">,</span><span class="w"> </span><span class="n">entries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc1</span><span class="o">.</span><span class="n">eDep</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>Each of these variables (<code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">sum2</span></code> and <code class="docutils literal notranslate"><span class="pre">entries</span></code>) is a <code class="docutils literal notranslate"><span class="pre">20×20×40</span> <span class="pre">Array</span></code> corresponding to the deposit energy.
Let’s see a X-Y plane of it in the middle of the Z axis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">sum</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20×20 Matrix{Float64}:
 22.6907    8.23238   9.53181   14.7324  …  12.409     7.39246  17.7415
 11.2568   10.365    21.2517    24.7346     17.5209   15.3881    1.71277
 12.9987   15.2373   14.4912    48.1607     22.5194   19.1845   11.8564
  9.42243  19.6698   23.8529    37.7654     19.5384   21.3335   13.5281
 22.8952   24.6838   37.5823    52.9955     30.5014   33.8069   13.4116
 25.7023   25.9152   33.594     74.3156  …  26.7333   24.8169   28.8356
 32.9647   38.8203   49.2023    69.869      34.747    17.5358   23.1117
 26.5994   42.2314   62.3937    68.9426     74.4483   26.0788   33.6273
 11.4288   38.1839   59.5371   116.112      54.4134   35.2306   21.319
 16.6416   46.9006   65.8704   109.926      40.7341   46.4459   27.2181
 19.2279   44.3896   75.6179   104.706   …  73.4129   59.2247   32.4233
 20.4118   47.9795   59.2302   126.023      58.434    62.0383   41.5008
 24.6917   46.6389   60.4266    95.9413     80.301    29.0629   28.9642
 17.0803   32.8747   49.331     87.1838     37.8035   38.9716   39.1364
 12.9969   36.0215   43.2987    53.7823     57.9662   18.7645   20.4736
 13.24     24.9719   27.4121    42.8602  …  29.3471   21.7373   11.0561
  9.799    21.3981   30.4914    31.8881     35.2386   31.7529   11.3309
  6.4313   15.8679   37.8778    28.2031     33.2141    9.74859  10.3116
  5.79865  13.9472   13.9546    27.2462     14.7916    8.13246  11.2221
  6.29478  14.4728    7.10103   16.5264      7.39579  14.2824    9.63563
</pre></div>
</div>
</div>
</div>
<p>A better way to to plot a heatmap with Makie.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">heatmap</span><span class="p">(</span><span class="n">sum</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:thermal</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Edep (XY)&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="s">&quot;image/png&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Invalid</span> <span class="n">attributes</span> <span class="n">color</span> <span class="ow">and</span> <span class="n">title</span> <span class="k">for</span> <span class="n">plot</span> <span class="nb">type</span> <span class="n">Heatmap</span><span class="p">{</span><span class="n">Tuple</span><span class="p">{</span><span class="n">MakieCore</span><span class="o">.</span><span class="n">EndPoints</span><span class="p">{</span><span class="n">Float32</span><span class="p">},</span> <span class="n">MakieCore</span><span class="o">.</span><span class="n">EndPoints</span><span class="p">{</span><span class="n">Float32</span><span class="p">},</span> <span class="n">Matrix</span><span class="p">{</span><span class="n">Float32</span><span class="p">}}}</span><span class="o">.</span>

<span class="n">The</span> <span class="n">available</span> <span class="n">plot</span> <span class="n">attributes</span> <span class="k">for</span> <span class="n">Heatmap</span><span class="p">{</span><span class="n">Tuple</span><span class="p">{</span><span class="n">MakieCore</span><span class="o">.</span><span class="n">EndPoints</span><span class="p">{</span><span class="n">Float32</span><span class="p">},</span> <span class="n">MakieCore</span><span class="o">.</span><span class="n">EndPoints</span><span class="p">{</span><span class="n">Float32</span><span class="p">},</span> <span class="n">Matrix</span><span class="p">{</span><span class="n">Float32</span><span class="p">}}}</span> <span class="n">are</span><span class="p">:</span>

<span class="n">alpha</span>        <span class="n">depth_shift</span>      <span class="n">inspector_hover</span>  <span class="n">nan_color</span>       <span class="n">transparency</span>
<span class="n">clip_planes</span>  <span class="n">fxaa</span>             <span class="n">inspector_label</span>  <span class="n">overdraw</span>        <span class="n">visible</span>     
<span class="n">colormap</span>     <span class="n">highclip</span>         <span class="n">interpolate</span>      <span class="n">space</span>                       
<span class="n">colorrange</span>   <span class="n">inspectable</span>      <span class="n">lowclip</span>          <span class="n">ssao</span>                        
<span class="n">colorscale</span>   <span class="n">inspector_clear</span>  <span class="n">model</span>            <span class="n">transformation</span>              


<span class="n">Generic</span> <span class="n">attributes</span> <span class="n">are</span><span class="p">:</span>

<span class="n">clip_planes</span>  <span class="n">dim_conversions</span>  <span class="n">model</span>      <span class="n">transformation</span>  <span class="n">yautolimits</span>        
<span class="n">cycle</span>        <span class="n">label</span>            <span class="n">rasterize</span>  <span class="n">xautolimits</span>     <span class="n">zautolimits</span>        



<span class="ne">Stacktrace</span>:
 <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">validate_attribute_keys</span><span class="p">(</span><span class="n">plot</span><span class="p">::</span><span class="n">Heatmap</span><span class="p">{</span><span class="n">Tuple</span><span class="p">{</span><span class="n">MakieCore</span><span class="o">.</span><span class="n">EndPoints</span><span class="p">{</span><span class="n">Float32</span><span class="p">},</span> <span class="n">MakieCore</span><span class="o">.</span><span class="n">EndPoints</span><span class="p">{</span><span class="n">Float32</span><span class="p">},</span> <span class="n">Matrix</span><span class="p">{</span><span class="n">Float32</span><span class="p">}}})</span>
   <span class="o">@</span> <span class="n">MakieCore</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">MakieCore</span><span class="o">/</span><span class="n">zO6H4</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">recipes</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">758</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">push</span><span class="o">!(</span>scene::Scene,<span class="w"> </span>plot::Plot<span class="o">)</span>
   <span class="o">@</span> <span class="n">Makie</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Makie</span><span class="o">/</span><span class="n">pFPBw</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">scenes</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">489</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">plot</span><span class="err">!</span>
   <span class="o">@</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Makie</span><span class="o">/</span><span class="n">pFPBw</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">interfaces</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">413</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">plot</span><span class="o">!(</span>ax::Axis,<span class="w"> </span>plot::Heatmap<span class="o">{</span>Tuple<span class="o">{</span>MakieCore.EndPoints<span class="o">{</span>Float32<span class="o">}</span>,<span class="w"> </span>MakieCore.EndPoints<span class="o">{</span>Float32<span class="o">}</span>,<span class="w"> </span>Matrix<span class="o">{</span>Float32<span class="o">}}})</span>
   <span class="o">@</span> <span class="n">Makie</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Makie</span><span class="o">/</span><span class="n">pFPBw</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">figureplotting</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">412</span>
 <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">plot</span><span class="o">!(</span>fa::Makie.FigureAxis,<span class="w"> </span>plot::Heatmap<span class="o">{</span>Tuple<span class="o">{</span>MakieCore.EndPoints<span class="o">{</span>Float32<span class="o">}</span>,<span class="w"> </span>MakieCore.EndPoints<span class="o">{</span>Float32<span class="o">}</span>,<span class="w"> </span>Matrix<span class="o">{</span>Float32<span class="o">}}})</span>
   <span class="o">@</span> <span class="n">Makie</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Makie</span><span class="o">/</span><span class="n">pFPBw</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">figureplotting</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">407</span>
 <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">_create_plot</span><span class="p">(</span><span class="n">F</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span> <span class="n">attributes</span><span class="p">::</span><span class="n">Dict</span><span class="p">{</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">Any</span><span class="p">},</span> <span class="n">args</span><span class="p">::</span><span class="n">Matrix</span><span class="p">{</span><span class="n">Float64</span><span class="p">})</span>
   <span class="o">@</span> <span class="n">Makie</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Makie</span><span class="o">/</span><span class="n">pFPBw</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">figureplotting</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">318</span>
 <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="c1">#heatmap#37</span>
   <span class="o">@</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">MakieCore</span><span class="o">/</span><span class="n">zO6H4</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">recipes</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">501</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
   <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">heatmap</span><span class="p">(</span><span class="n">sum</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="o">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:thermal</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Edep (XZ)&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="s">&quot;image/png&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.11"
        },
        kernelOptions: {
            name: "julia-1.11",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.11'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="08-sensitive-detectors.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Sensitive Detectors</p>
      </div>
    </a>
    <a class="right-next"
       href="10-histograms.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Histograms</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Pere Mato
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright CERN, The Contributors 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>